library(readstata13)
library(tidyverse)
nunn <- read.dta13("slave_trade_QJE.dta")
## IVLS estimator
IVLS <- function(X,Z,Y){
gamma_hat <- solve(t(Z)%*%Z)%*%t(Z)%*%X
}
## 2SLS estimator
## IVLS estimator
IVLS <- function(X,Z,Y){
gamma_hat <- solve(t(Z)%*%Z)%*%t(Z)%*%X
x_bar <- Z%*%gamma_hat
#then regress Y on x-bar
2sls <- solve(t(x_bar)%*%x_bar)%*%t(x_bar)%*%Y
## IVLS estimator
IVLS <- function(X,Z,Y){
gamma_hat <- solve(t(Z)%*%Z)%*%t(Z)%*%X
x_bar <- Z%*%gamma_hat
# then regress Y on x-bar
two_sls <- solve(t(x_bar)%*%x_bar)%*%t(x_bar)%*%Y
}
## 2SLS estimator
IVLS_1<- IVLS(nunn$ln_export_area, nunn$atlantic_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_2 <- IVLS(nunn$ln_export_area, nunn$indian_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_3 <- IVLS(nunn$ln_export_area, nunn$saharan_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_4 <- IVLS(nunn$ln_export_area, nunn$red_sea_distance_minimum, nunn$ln_maddison_pcgdp2000)
## 2sls estimator
twoSLS <- function(X,Z,Y){
gamma_hat <- solve(t(Z)%*%Z)%*%t(Z)%*%X
x_bar <- Z%*%gamma_hat
# then regress Y on x-bar
two_sls <- solve(t(x_bar)%*%x_bar)%*%t(x_bar)%*%Y
}
IVLS_1 <- twoSLS(nunn$ln_export_area, nunn$atlantic_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_2 <- twoSLS(nunn$ln_export_area, nunn$indian_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_3 <- twoSLS(nunn$ln_export_area, nunn$saharan_distance_minimum, nunn$ln_maddison_pcgdp2000)
IVLS_4 <- twoSLS(nunn$ln_export_area, nunn$red_sea_distance_minimum, nunn$ln_maddison_pcgdp2000)
## 2SLS estimator
b_hat <- solve(t(X)%*%Z%*%solve(t(Z)%*%Z)%*%t(Z)%*%X)%*%t(X)%*%Z%*%solve(t(Z)%*%Z)%*%t(Z)%*%Y
IVLS <- function(X,Y,Z){
b_hat <- solve(t(X)%*%Z%*%solve(t(Z)%*%Z)%*%t(Z)%*%X)%*%t(X)%*%Z%*%solve(t(Z)%*%Z)%*%t(Z)%*%Y
}
knitr::opts_chunk$set(echo = TRUE)
treatment <- c(rep(1,2000), rep(0, 2000))
summarise(treatment)
summarize(treatment )
mean(treatment)
2000*0.75
2000*0.7525
2000-1505
# There are 2000 units assigned to control, 75 percent have a value of 1
# There are 2000 units assigned to treatment, 75.25 % have a value of 1
treatment <- c(rep(1,2000), rep(0, 2000))
outcome <- c(rep(1,1500), rep(0, 500), rep(1, 1505), rep(0, 495))
mean(outcome)
data <- cbind(treatment, outcome)
data <- as.dataframe(cbind(treatment, outcome))
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt(var1/length(treated)) + var0/length(not_treated))
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated)))
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated))
}
itt <- ITT(treatment, outcome)
itt
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated))
return(c("ITT" = itt, "SE ITT" = se_itt))
}
itt <- ITT(treatment, outcome)
itt
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated))
# t stat
t_stat <- itt / se_itt
df <- (var1/length(treated) + var0/length(not_treated))Ë†2 /
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated))
# t stat
t_stat <- itt / se_itt
df <- (var1/length(treated) + var0/length(not_treated))^2 /
((var1/length(treated))Ë†2 / (length(treated) - 1) +
ITT <- function(treatment, outcome){
mean_control <- mean(outcome[treatment == 0])
mean_treatment <- mean(outcome[treatment == 1])
itt <- mean_treatment - mean_control
#standard error
treated <- outcome[treatment == 1]
var1 <- sum((treated - mean(treated))^2) / (length(treated) - 1)
not_treated <- outcome[treatment == 0]
var0 <- sum((not_treated - mean(not_treated))^2) / (length(not_treated) - 1)
#se_itt
se_itt <- sqrt((var1/length(treated)) + var0/length(not_treated))
# t stat
t_stat <- itt / se_itt
df <- (var1/length(treated) + var0/length(not_treated))^2 /
((var1/length(treated))^2 / (length(treated) - 1) +
(var0/length(not_treated))^2 / (length(not_treated) - 1))
# p value
p_value <- pt(-abs(t_stat), df = df, ncp = 0, lower.tail = TRUE) +
pt(abs(t_stat), df = df, ncp = 0, lower.tail = FALSE)
return(c("ITT" = itt, "SE ITT" = se_itt, "p-value" = p_value))
}
itt <- ITT(treatment, outcome)
print(itt)
